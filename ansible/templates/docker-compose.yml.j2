version: '3'
services:
  {{ app_name }}:
    image: "{{ docker.image }}:{{ docker.tag }}"
    container_name: "{{ app_name }}"
    restart: always
    volumes:
      - /opt/it-news-bot/data:/root/data
    env_file:
      - .env
    networks:
      - {{ traefik.network }}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.{{ app_name }}.entrypoints=https"
      - "traefik.http.routers.{{ app_name }}.rule=Host(`{{ traefik.api_host }}`) && PathPrefix(`{{ traefik.api_prefix }}`)"
      - "traefik.http.routers.{{ app_name }}.tls=true"
      - "traefik.http.routers.{{ app_name }}.tls.certresolver={{ traefik.le_resolver }}"
      - "traefik.http.services.{{ app_name }}-service.loadbalancer.server.port=8080"
      - "traefik.http.routers.{{ app_name }}.middlewares=traefik-compress"

networks:
  # Докер сеть, в которой находится traefik.
  {{ traefik.network }}:
    name: "{{ traefik.network }}"
    external: true